# Implementation Plan: Incident Response Coordination

**Branch**: `001-incident-response` | **Date**: 2025-10-21 | **Spec**: `../spec.md`
**Input**: Feature specification from `/specs/001-incident-response/spec.md`

**Note**: This template is filled in by the `/speckit.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

- **Mission alignment**: Deliver end-to-end emergency incident coordination that satisfies
  speed, reliability, trust, privacy, and scalability mandates from the ResQ Link
  constitution.
- **Delivery strategy**: Turborepo monorepo hosting Expo mobile app, Next.js dispatcher web
  console, and NestJS API. Shared packages provide types, UI primitives, and utilities for
  consistent behavior across surfaces.
- **Roadmap highlights**:
  - **M0 (1 week)**: Monorepo scaffolding, linting, pnpm workspaces, shared package shells.
  - **M1 (2 weeks)**: NestJS API foundation with Prisma/PostgreSQL, JWT auth, staging DB.
  - **M2 (2 weeks)**: Public incident submission endpoint, WebSocket broadcasts, basic
    dispatcher dashboard.
  - **M3 (2 weeks)**: Expo mobile reporting flow with location, media capture, anonymous
    submission UX.
  - **M4 (2 weeks)**: Authenticated responder/admin flows, assignment operations, Expo push
    notifications.
  - **M5 (1.5 weeks)**: Media upload pipeline with signed URLs, incident media views,
    automated tests.
  - **M6 (2 weeks)**: Analytics, rate limiting via Redis, telemetry hardening, SLOs.
  - **M7 (1.5 weeks)**: QA, docs, IaC, CI/CD pipelines, production go-live readiness.

Estimated MVP timeline: **12–14 weeks** with parallel workstreams (backend, mobile, web,
infra).

## Technical Context

- **Language/Version**: TypeScript 5.x across monorepo (Node 20 LTS runtime).
- **Primary Dependencies**: Turborepo, pnpm workspaces, NestJS (+Socket.io adapter), Prisma,
  Next.js (App Router), Expo SDK, shadcn/ui, Zod, Husky, lint-staged.
- **Storage**: PostgreSQL (managed; staging + production), Redis (session + rate limiting),
  Object storage (AWS S3 or Cloudflare R2) for media.
- **Testing**: Jest + ts-jest for unit, Supertest for API integration, Playwright for web
  E2E, Detox/Expo E2E suites for mobile, k6 for load/WebSocket stress.
- **Target Platform**: Web (Next.js SSR+CSR), Mobile (iOS/Android via Expo), API (Node/NestJS
  on Linux containers), background workers (Node).
- **Project Type**: Turborepo monorepo with apps (`mobile`, `web`, `api`) and shared packages
  (`types`, `ui`, `config`, `testing`).
- **Performance Goals**: Dispatcher dashboard updates within 2s, 95th percentile API read
  latency ≤300ms, write latency ≤700ms, WS fan-out for ≥200 concurrent clients, push
  acknowledgement ≤30s.
- **Constraints**: Offline-capable mobile submissions, privacy-preserving data retention,
  auditable status transitions, horizontal scaling on commodity cloud infra.
- **Scale/Scope**: MVP targeting city-scale incidents (5k active records, 200 concurrent
  responders/dispatchers). Delivery in seven milestones over ~14 weeks with four core
  engineers + part-time product/design.

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- **Speed-First Emergency Reporting**: Plan enforces <10s submission UX, <2s dispatch
  visibility via WebSocket fan-out and offline queueing. PASS.
- **Reliability & Real-Time Synchronization**: WebSocket gateway backed by Redis ensures
  event replay; staging SLOs codified in testing strategy. PASS.
- **Trust & Accountability Safeguards**: Audit logging for status/assignment flows, role
  based permissions, analytics on response times. PASS.
- **Privacy-Conscious Data Stewardship**: Minimal personal data capture, retention policy
  automation, secure storage practices integrated. PASS.
- **Horizontal Scalability & Graceful Degradation**: Stateless services, Redis-backed
  sessions, queued mobile submissions; load testing scheduled for M6/M7. PASS.

## Project Structure

### Documentation (this feature)

```
specs/001-incident-response/
├── plan.md
├── research.md
├── data-model.md
├── quickstart.md
├── contracts/
│   ├── incidents.yml
│   ├── assignments.yml
│   ├── uploads.yml
│   └── notifications.yml
└── tasks.md (generated by /speckit.tasks)
```

### Source Code (repository root)
<!--
  ACTION REQUIRED: Replace the placeholder tree below with the concrete layout
  for this feature. Delete unused options and expand the chosen structure with
  real paths (e.g., apps/admin, packages/something). The delivered plan must
  not include Option labels.
-->

```
apps/
├── api/                # NestJS
│   ├── src/
│   │   ├── modules/
│   │   │   ├── auth/
│   │   │   ├── incidents/
│   │   │   ├── users/
│   │   │   ├── uploads/
│   │   │   └── notifications/
│   │   ├── websockets/
│   │   └── main.ts
│   └── test/
├── web/                # Next.js dispatcher/admin UI
│   ├── app/
│   ├── components/
│   ├── lib/
│   └── tests/
└── mobile/             # Expo app for citizens/responders
    ├── app/
    ├── components/
    ├── hooks/
    └── tests/

packages/
├── types/
├── ui/
├── config/
└── testing/

infrastructure/
├── terraform/ (or pulumi)
└── scripts/

.github/workflows/
├── ci.yml
└── deploy.yml
```

**Structure Decision**: Adopt Turborepo with `apps/{api,web,mobile}` and shared `packages/*`
for types, UI kit, configuration, and testing utilities. Infrastructure and GitHub Actions
pipelines live alongside. Aligns with milestones and supports parallel teams.

## Complexity Tracking

*Fill ONLY if Constitution Check has violations that must be justified*

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| _None_ | — | — |

